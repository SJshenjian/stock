<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>历史数据</title>
    <#include "../common_css.html" />
</head>
<body>
<div class="layui-tab layui-tab-brief">
    <label class="layui-form-label">学校名称:</label>
    <div class="layui-input-inline">
        <input id="school" type="text" name="title" lay-verify="title" autocomplete="off" placeholder="请输入学校名称" class="layui-input">
    </div>
</div>
<div class="layui-inline">
    <label class="layui-form-label">招生年份</label>
    <div class="layui-input-inline">
        <input id="year" type="text" class="layui-input" placeholder="请选择招生年份">
    </div>
</div>
<div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
        <label class="layui-form-label">参数指标:</label>
        <ul class="layui-tab-title historyType" style="border-bottom-style: none">
            <li code="firstTest">初试成绩</li>
            <li code="secondTest">复试成绩(百分制)</li>
            <li code="score">综合成绩(百分制)</li>
        </ul>
        <div id="echarts" style="width: 100%;height:600px;"></div>
    </div>
<#include "../common_js.html" />
<script>
    $(function () {
        // 试题历史行情
        var getExamHistory = function (school, year, historyType) {
            $.ajax({
                url: '/exam/getExamHistory',
                data: {
                    school: school,
                    year: year
                },
                type: 'POST',
                dataType: 'JSON',
                success: function(ret) {
                    if (ret && ret.O_CODE > 0) {
                        var result = ret.O_RESULT;
                        if (result != null && result.length > 0) {
                            $('#echarts').html();
                            // 基于准备好的dom，初始化echarts实例
                            var myChart = echarts.init(document.getElementById('echarts'));
                            var xData = [];
                            var seriesData = [];
                            for (var i = result.length - 1; i >= 0; i--) {
                                xData.push(result[i]['student']);
                                seriesData.push(result[i][historyType]);
                            }
                            // 指定图表的配置项和数据
                            var option = {
                                tooltip : {
                                    trigger: 'item'
                                },
                                xAxis: {
                                    type: 'category',
                                    data: xData
                                },
                                yAxis: {
                                    type: 'value'
                                },
                                dataZoom: [
                                    {
                                        type: 'slider',
                                        show: true,
                                        start: 0,
                                        end: 100,
                                    },{
                                        type: 'inside',
                                        show: true,
                                        start: 0,
                                        end: 100,
                                    }
                                ],
                                series: [{
                                    data: seriesData,
                                    type: 'line',
                                    smooth: true
                                }]
                            };
                            // 使用刚指定的配置项和数据显示图表
                            myChart.setOption(option);
                        } else {
                            layer.msg('暂无该学校考研的相关信息');
                        }
                    } else {
                        layer.msg(ret['O_NOTE']);
                    }
                },
            });
        };

        $('.historyType li').each(function () {
            $(this).unbind('click').click(function() {
                var school = $('#school').val();
                if (null == school || school.trim().length <= 0) {
                    layer.msg("请输入学校名称");
                    return ;
                }
                var year = $('#year').val();
                if (null == year || year.trim().length <= 0) {
                    layer.msg("请输入招生年份");
                    return ;
                }
                var historyType = $(this).attr('code');
                getExamHistory(school, year, historyType)
            });
        });

        layui.use('laydate', function() {
            var laydate = layui.laydate;

            //年选择器
            laydate.render({
                elem: '#year'
                , type: 'year'
            });
        });
    })
</script>
</body>
</html>